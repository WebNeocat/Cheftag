{% extends "base.html" %}
{% block content %}

<div class="content-wrapper">
    <div class="card shadow-lg">
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
            <h3 class="m-0">Registro de auditoria</h3>
        </div>
        <!-- Body -->
        <div class="card-body">
        {% if registros %}
        <div class="table-responsive">
            <table class="table table-hover align-middle">
            <thead class="table-dark">
                <tr>
                <th>Fecha</th>
                <th>Usuario</th>
                <th>Acción</th>
                <th>Objeto</th>
                <th>Opciones</th>
                </tr>
            </thead>
            <tbody>
                {% for registro in registros %}
                <tr>
                <td>{{ registro.fecha|date:"d/m/Y H:i:s" }}</td>
                <td>{{ registro.usuario }}</td>
                <td>
                    {% if registro.accion == "crear" %}
                    <span class="badge bg-success"><i class="fa fa-plus-circle"></i> Crear</span>
                    {% elif registro.accion == "modificar" %}
                    <span class="badge bg-warning text-dark"><i class="fa fa-edit"></i> Modificar</span>
                    {% elif registro.accion == "eliminar" %}
                    <span class="badge bg-danger"><i class="fa fa-trash"></i> Eliminar</span>
                    {% else %}
                    <span class="badge bg-secondary">{{ registro.accion }}</span>
                    {% endif %}
                </td>
                <td>{{ registro.objeto_repr }}</td>
                <td>
                    <button 
                    class="btn btn-inverse-success"
                    onclick="abrir_modal_detalle('{% url 'core:registro_accion_detail' registro.id %}')">
                    <i class="fa fa-eye"></i> Ver
                    </button>
                </td>
                </tr>
                {% endfor %}
            </tbody>
            </table>
        </div>

        <!-- Paginación -->
        {% include "core/pagination.html" %}

        {% else %}
        <div class="alert alert-warning text-center">
            <i class="fa fa-exclamation-circle"></i> No se encontraron registros de auditoría.
        </div>
        {% endif %}
        </div>
    </div>
</div>

  <!-- Modal -->
  <div class="modal fade" id="detalleRegistroModal" tabindex="-1" aria-hidden="true"></div>
</div>

{% endblock content %}

{% block extrajs %}
<script type="text/javascript">
  function abrir_modal_detalle(url){
    $('#detalleRegistroModal').load(url, function(){
      $(this).modal('show');
    });
  }
</script>
{% endblock extrajs %}
