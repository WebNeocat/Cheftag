<!-- templates/recepciones/recepcion_gs1.html -->
{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container mt-3">
    <h3 class="text-center">ðŸ“¦ RecepciÃ³n por GS1</h3>

    <!-- CÃ¡mara -->
    <video id="preview" style="width:100%; border:1px solid #ddd; border-radius:8px;"></video>

    <!-- Input oculto para el cÃ³digo -->
    <form method="POST" id="formRecepcion">
        {% csrf_token %}
        <input type="hidden" id="codigo" name="codigo">
    </form>

    <!-- Mensajes Django -->
    {% if messages %}
        <div class="mt-3">
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }}">{{ message }}</div>
            {% endfor %}
        </div>
    {% endif %}
</div>

<!-- ZXing library -->
<script src="https://unpkg.com/@zxing/library@latest"></script>
<script>
    const codeReader = new ZXing.BrowserBarcodeReader();
    codeReader.decodeFromVideoDevice(null, 'preview', (result, err) => {
        if (result) {
            document.getElementById('codigo').value = result.text;
            document.getElementById('formRecepcion').submit();
        }
    });
</script>
{% endblock %}

