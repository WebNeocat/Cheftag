{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
  <h1 class="mb-4 text-center">Dashboard</h1>

  <!-- Estadísticas rápidas -->
  <div class="row text-center mb-4">
    <div class="col-12 col-md-4 mb-3">
      <div class="card shadow-sm rounded-3 p-4 bg-light">
        <h5 class="card-title">Total Platos</h5>
        <h3>{{ stats.total_platos }}</h3>
      </div>
    </div>
    <div class="col-12 col-md-4 mb-3">
      <div class="card shadow-sm rounded-3 p-4 bg-light">
        <h5 class="card-title">Total Recetas</h5>
        <h3>{{ stats.total_recetas }}</h3>
      </div>
    </div>
    <div class="col-12 col-md-4 mb-3">
      <div class="card shadow-sm rounded-3 p-4 bg-light">
        <h5 class="card-title">Total Alimentos</h5>
        <h3>{{ stats.total_alimentos }}</h3>
      </div>
    </div>
  </div>

  <!-- Gráficos principales -->
  <div class="row">
    <div class="col-12 col-md-6 mb-4">
      <div class="card shadow-sm rounded-3 p-4 bg-light">
        <h5 class="card-title text-center">Platos más creados</h5>
        <div class="chart-container" style="height: 300px;">
          <canvas id="platosChart"></canvas>
        </div>
      </div>
    </div>

    <div class="col-12 col-md-6 mb-4">
      <div class="card shadow-sm rounded-3 p-4 bg-light">
        <h5 class="card-title text-center">Alimentos más usados</h5>
        <div class="chart-container" style="height: 300px;">
          <canvas id="alimentosChart"></canvas>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-12 mb-4">
      <div class="card shadow-sm rounded-3 p-4 bg-light">
        <h5 class="card-title text-center">Raciones servidas (últimos 7 días)</h5>
        <div class="chart-container" style="height: 300px;">
          <canvas id="racionesChart"></canvas>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const chartOptions = {
    responsive: true,
    maintainAspectRatio: false,
    animation: { duration: 1000, easing: 'easeOutQuart' },
    plugins: {
      legend: { position: 'top', labels: { font: { size: 14 } } },
      tooltip: { mode: 'index', intersect: false, backgroundColor: 'rgba(0,0,0,0.7)', titleFont: {size:14}, bodyFont:{size:12} }
    },
    scales: {
      y: { beginAtZero: true, ticks: { stepSize: 1, font: {size:12} } },
      x: { ticks: { font: { size: 12 } } }
    },
    hover: {
      mode: 'nearest',
      intersect: true
    }
  };

  // Platos más creados con gradiente azul
  const ctxPlatos = document.getElementById("platosChart").getContext('2d');
  const gradientPlatos = ctxPlatos.createLinearGradient(0, 0, 0, 300);
  gradientPlatos.addColorStop(0, 'rgba(54, 162, 235, 0.8)');
  gradientPlatos.addColorStop(1, 'rgba(54, 162, 235, 0.3)');

  new Chart(ctxPlatos, {
    type: 'bar',
    data: {
      labels: {{ platos_labels|safe }},
      datasets: [{
        label: 'Platos más creados',
        data: {{ platos_values|safe }},
        backgroundColor: gradientPlatos,
        hoverBackgroundColor: 'rgba(54, 162, 235, 1)',
        borderRadius: 5
      }]
    },
    options: chartOptions
  });

  // Alimentos más usados con colores suaves
  new Chart(document.getElementById("alimentosChart"), {
    type: 'pie',
    data: {
      labels: {{ alimentos_labels|safe }},
      datasets: [{
        label: 'Alimentos más usados',
        data: {{ alimentos_values|safe }},
        backgroundColor: ['#FF6384','#36A2EB','#FFCD56','#4BC0C0','#9966FF'],
        hoverOffset: 10
      }]
    },
    options: chartOptions
  });

  // Raciones últimos 7 días con línea azul y puntos destacados
  new Chart(document.getElementById("racionesChart"), {
    type: 'line',
    data: {
      labels: {{ raciones_labels|safe }},
      datasets: [{
        label: 'Raciones servidas',
        data: {{ raciones_values|safe }},
        borderColor: 'rgba(75, 192, 192, 1)',
        backgroundColor: 'rgba(75, 192, 192, 0.2)',
        fill: true,
        tension: 0.3,
        pointRadius: 6,
        pointHoverRadius: 8,
        pointBackgroundColor: 'rgba(75,192,192,1)'
      }]
    },
    options: chartOptions
  });
</script>
{% endblock %}



